---
import Layout from '@/layouts/Layout.astro'

import { getBlogEntries, getBlogEntry } from '@/contentful/parsed'
import { EntryBlog } from '@/components/ui/EntryBlog'

export async function getStaticPaths() {
  const CONTENTFUL_SPACE_ID = import.meta.env.CONTENTFUL_SPACE_ID
  const CONTENTFUL_TOKEN = import.meta.env.CONTENTFUL_TOKEN

  const entries = await getBlogEntries({ space: CONTENTFUL_SPACE_ID, accessToken: CONTENTFUL_TOKEN })
  const blogEntries = entries?.map((entry) => ({ params: { id: entry.url } }))

  return blogEntries
}

const { id } = Astro.params

const entry = await getBlogEntry({
  space: import.meta.env.CONTENTFUL_SPACE_ID,
  accessToken: import.meta.env.CONTENTFUL_TOKEN,
  url: id ?? '',
})

if (!entry) {
  throw new Error('No se ha encontrado la entrada')
}
---

<Layout>
  <article class="mx-auto mt-6 flex w-full max-w-4xl flex-col items-start gap-6 px-6 md:mt-12 md:px-4">
    {entry && <EntryBlog data={entry} />}
  </article>
</Layout>
