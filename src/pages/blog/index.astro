---
import Layout from '@/layouts/Layout.astro'
import { getBlogEntries } from '@/contentful/parsed'
import Card from '@/components/Card.astro'
import Container from '@/components/Container.astro'
// import { CONTENTFUL_MODE } from '@/contentful/config'

const CONTENTFUL_SPACE_ID = import.meta.env.CONTENTFUL_SPACE_ID
const CONTENTFUL_TOKEN = import.meta.env.CONTENTFUL_TOKEN
// const CONTENTFUL_TOKEN = import.meta.env.CONTENTFUL_PREVIEW_TOKEN

const entries = await getBlogEntries({
  space: CONTENTFUL_SPACE_ID,
  accessToken: CONTENTFUL_TOKEN,
  // mode: CONTENTFUL_MODE.PREVIEW,
})

if (!entries) {
  throw new Error('No se ha encontrado la entrada')
}
---

<Layout title="Blog">
  <Container class="mt-4 flex flex-col justify-center justify-items-center gap-x-8 gap-y-2">
    <h1 class:list={['inline-block self-center text-h5 font-bold', 'md:text-h3 md:leading-tight']}>Blog</h1>
    <h2 class:list={['inline-block self-center text-balance text-body1 opacity-60', 'md:text-h5 md:leading-tight']}>
      Últimos artículos de Programación Frontend
    </h2>

    <ul class="my-4 grid w-full grid-cols-[repeat(auto-fill,minmax(270px,1fr))] gap-4">
      {
        entries &&
          entries.map((e) => (
            <li>
              <a href={`/blog/${e.url}`}>
                <Card clickable="yes" title={e.title}>
                  <img
                    alt="Art"
                    src={
                      e.image?.url ??
                      'https://images.unsplash.com/photo-1605721911519-3dfeb3be25e7?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=80'
                    }
                    class="mb-2 h-40 w-full rounded-sm object-cover"
                  />

                  <h3 class="mb-1 line-clamp-1 w-auto text-h6 font-extrabold">{e.title}</h3>
                  <p class="line-clamp-4 text-balance text-body2" set:html={e.description} />
                </Card>
              </a>
            </li>
          ))
      }
    </ul>
  </Container>
</Layout>
